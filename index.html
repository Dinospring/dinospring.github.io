<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TI4 Production Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .counter-container {
            margin-top: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        .counter {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            max-width: 340px;
            justify-content: flex-start;
            padding: 4px 0;
        }
        .counter .count {
            font-size: 18px;
            font-weight: 600;
            min-width: 28px;
            text-align: center;
        }
        .counter p {
            font-size: 18px;
            margin: 0;
            flex: 0 0 115px;
            text-align: left;
        }
        .arrow-button, #reset-all {
            padding: 6px 14px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 18px;
            border-radius: 5px;
            flex: 0 0 auto;
            min-width: 44px;
            transition: background-color 0.18s ease;
        }
        .arrow-button:hover {
            background-color: #0056b3;
        }
        /* Adjust the width of the resources input field */
        #resources, #production {
            width: 40px; /* Adjust the width as needed */
			margin: 5px;
            align-items: center;
			font-size: 18px;
        }
        #reset-all {
            background-color: #FF4500;
        }
        #total {
            font-size: 24px;
            margin-top: 10px;
        }
        #warning, #warning-production {
            color: red;
            font-weight: bold;
        }
        .counter img {
            width: 50px;
            height: 40px;
            object-fit: contain;
            flex: 0 0 50px;
        }
        .progress-container {
            width: 100%;
            background-color: #ddd;
            height: 20px;
            margin-top: 10px;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar {
            width: 0;
            height: 100%;
            background-color: #007BFF;
            transition: width 0.3s, background-color 0.3s;
        }
        .progress-bar.exceeded {
            background-color: #FF4500;
        }
        /* Tooltip for accessibility (visible and announced via aria-live) */
        .tooltip {
            position: absolute;
            display: none;
            align-items: center;
            background: rgba(0,0,0,0.85);
            color: #fff;
            padding: 8px 10px;
            border-radius: 6px;
            font-size: 14px;
            max-width: 640px;
            /* allow tooltip to grow when showing a large icon */
            z-index: 9999;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .tooltip img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            margin-right: 12px;
            flex: 0 0 auto;
        }
        /* Fun larger checkbox styling for Sarween Tools */
        input#sarween {
            /* scale native checkbox for wide browser support */
            transform: scale(1.6);
            width: 20px;
            height: 20px;
            margin-right: 6px;
            vertical-align: middle;
            accent-color: #FFD166; /* modern browsers will color the check */
            transition: transform 0.12s ease, box-shadow 0.12s ease;
            cursor: pointer;
        }

        label[for="sarween"] {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 10px;
            background: rgba(0,0,0,0.04);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.18s ease, transform 0.12s ease, box-shadow 0.18s ease;
        }

        /* Hover/active playful effects */
        input#sarween:hover { transform: scale(1.85); }
        label[for="sarween"]:hover { transform: translateY(-2px); box-shadow: 0 6px 14px rgba(0,0,0,0.08); }

        /* When checked make the label colorful */
        input#sarween:checked + label[for="sarween"] {
            background: linear-gradient(90deg,#FFD166 0%, #FF4500 100%);
            color: #0b0b0b;
            box-shadow: 0 10px 30px rgba(255,69,0,0.18);
        }
        /* Utility class for screen-reader-only content (if needed) */
        .sr-only {
            position: absolute !important;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <label for="resources" title="this is the yellow number on all your unexhausted planets combined">Resources &#128176;:</label>
    <!-- Input field for resources value -->
    <input type="number" id="resources" value="5">
    <p>
	<label for="production" title="this is the production value on your space dock (the planet it is standing on matters!). this is the amount of plastic you can put down on the board in total">Production &#127981;:</label>
	<input type="number" id="production" value="5">
	</p>
    <p>
    <input type="checkbox" id="sarween">
    <label for="sarween" title="When 1 or more of your units use Production, reduce the combined cost of the produced units by 1">Sarween Tools</label>
    </p>
    <div class="counter-container">
        <!-- Counter 1 with ID -->
        <div class="counter" id="counter1">
            <img src="fighter.png" alt="Counter 1">
            <p title="fighters ships don't count towards fleet size, but you must have CAPACITY from space docks or other ships" tabindex="0">Fighters (2x)</p>
            <button class="arrow-button decrement">-</button>
            <span class="count">0</span>
            <button class="arrow-button increment">+</button>
        </div>
		<!-- Counter 2 with ID -->
        <div class="counter" id="counter2">
            <img src="infantry.png" alt="Counter 2">
            <p title="Infantry don't count towards fleet size, but you must have CAPACITY on ships to take them off planet." tabindex="0">Infantry (2x)</p>
            <button class="arrow-button decrement">-</button>
            <span class="count">0</span>
            <button class="arrow-button increment">+</button>
        </div>
        <!-- Counter 3 with ID -->
        <div class="counter" id="counter3">
            <img src="cruiser.png" alt="Counter 3">
            <p>Cruiser</p>
            <button class="arrow-button decrement">-</button>
            <span class="count">0</span>
            <button class="arrow-button increment">+</button>
        </div>
        <!-- Counter 4 with ID -->
        <div class="counter" id="counter4">
            <img src="destroyer.png" alt="Counter 4">
            <p>Destroyer</p>
            <button class="arrow-button decrement">-</button>
            <span class="count">0</span>
            <button class="arrow-button increment">+</button>
        </div>
		<!-- Counter 5 with ID -->
        <div class="counter" id="counter5">
            <img src="carrier.png" alt="Counter 5">
            <p>Carrier</p>
            <button class="arrow-button decrement">-</button>
            <span class="count">0</span>
            <button class="arrow-button increment">+</button>
        </div>
		<!-- Counter 6 with ID -->
        <div class="counter" id="counter6">
            <img src="dreadnought.png" alt="Counter 6">
            <p>Dreadnought</p>
            <button class="arrow-button decrement">-</button>
            <span class="count">0</span>
            <button class="arrow-button increment">+</button>
        </div>
		<!-- Counter 7 with ID -->
        <div class="counter" id="counter7">
            <img src="flagship.png" alt="Counter 7">
            <p>Flagship</p>
            <button class="arrow-button decrement">-</button>
            <span class="count">0</span>
            <button class="arrow-button increment">+</button>
        </div>
		<!-- Counter 8 with ID -->
        <div class="counter" id="counter8">
            <img src="war_sun.png" alt="Counter 8">
            <p>War Sun</p>
            <button class="arrow-button decrement">-</button>
            <span class="count">0</span>
            <button class="arrow-button increment">+</button>
        </div>
    </div>
    <button id="reset-all">Reset All</button>
    <!-- Display the total count -->

    <div id="total">Resources spent: <span id="total-count">0</span></div>
    <!-- Display a warning message -->
    <div id="warning"></div>
    <!-- Progress bar container -->
    <div class="progress-container">
        <!-- Progress bar element -->
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div id="total">Production spent: <span id="total-production-count">0</span></div>
    <!-- Display a warning message -->
    <div id="warning-production"></div>
    <!-- Progress bar container -->
    <div class="progress-container">
        <!-- Progress bar element -->
        <div class="progress-bar" id="progress-bar-production"></div>
	</div>

    <script>
        // Get reset button element
        const resetButton = document.getElementById("reset-all");
        // Get total count span element
        const totalSpanResources = document.getElementById("total-count");
        const totalSpanProduction = document.getElementById("total-production-count");
        const warningDiv = document.getElementById("warning");
        const warningProductionDiv = document.getElementById("warning-production");
        const resourcesInput = document.getElementById("resources");
        const InputProduction = document.getElementById("production");
    const sarweenCheckbox = document.getElementById("sarween");
        const progressBar = document.getElementById("progress-bar");
        const progressBarProduction = document.getElementById("progress-bar-production");
        // Tooltip/ARIA live region for accessible explanations
        // Visual tooltip element (also acts as a live region for screen readers)
        const tooltip = document.createElement('div');
        tooltip.id = 'tooltip';
        tooltip.className = 'tooltip';
        tooltip.setAttribute('role', 'status');
        tooltip.setAttribute('aria-live', 'polite');
        tooltip.setAttribute('aria-atomic', 'true');
        document.body.appendChild(tooltip);

        // Keep a timeout handle for touch interactions so the tooltip can auto-hide
        let touchHideTimer = null;

        function showTooltipFor(targetElement, text) {
            if (!targetElement || !text) return;
            // Clear previous contents
            while (tooltip.firstChild) tooltip.removeChild(tooltip.firstChild);

            // Optionally show the resource image next to the tooltip when the target is the resources input/label
            const showResourceIcon = (targetElement === resourcesInput) || (targetElement.id === 'resources') || (targetElement.tagName === 'LABEL' && targetElement.getAttribute('for') === 'resources');
            if (showResourceIcon) {
                const img = document.createElement('img');
                img.src = 'resource.png';
                img.alt = 'Resources';
                img.setAttribute('aria-hidden', 'true');
                tooltip.appendChild(img);
            }

            // Optionally show the space dock image next to the tooltip when the target is the production input/label
            const showProductionIcon = (targetElement === InputProduction) || (targetElement.id === 'production') || (targetElement.tagName === 'LABEL' && targetElement.getAttribute('for') === 'production');
            if (showProductionIcon) {
                const img = document.createElement('img');
                img.src = 'space_dock_1.png';
                img.alt = 'Space Dock';
                img.setAttribute('aria-hidden', 'true');
                tooltip.appendChild(img);
            }

            // Append a text node so aria-live announces changes
            const textSpan = document.createElement('span');
            textSpan.textContent = text;
            tooltip.appendChild(textSpan);

            // Show the tooltip as flex but keep it hidden while we measure its size
            tooltip.style.display = 'flex';
            tooltip.style.visibility = 'hidden';

            // Position tooltip below the target element, centering using measured tooltip width
            const rect = targetElement.getBoundingClientRect();
            const tipRect = tooltip.getBoundingClientRect();
            const left = Math.max(8, rect.left + window.scrollX + (rect.width / 2) - (tipRect.width / 2));
            const top = rect.bottom + window.scrollY + 8;
            tooltip.style.left = `${left}px`;
            tooltip.style.top = `${top}px`;
            // Reveal it now that we've positioned it
            tooltip.style.visibility = 'visible';

            // For touch interactions: auto-hide after 3.5s
            if (touchHideTimer) {
                clearTimeout(touchHideTimer);
                touchHideTimer = null;
            }
            touchHideTimer = setTimeout(() => {
                hideTooltip();
            }, 3500);
        }

        function hideTooltip() {
            tooltip.style.display = 'none';
            // Clear children so next show starts fresh
            while (tooltip.firstChild) tooltip.removeChild(tooltip.firstChild);
            if (touchHideTimer) {
                clearTimeout(touchHideTimer);
                touchHideTimer = null;
            }
        }

        // Helper to attach accessible listeners to an element
        function attachA11yHint(element, hintText) {
            if (!element) return;
            // Mouse & keyboard focus
            element.addEventListener('mouseenter', () => showTooltipFor(element, hintText));
            element.addEventListener('focus', () => showTooltipFor(element, hintText));
            element.addEventListener('mouseleave', hideTooltip);
            element.addEventListener('blur', hideTooltip);
            // Touch support: show on touchstart, hide after timeout or on touch elsewhere
            element.addEventListener('touchstart', (ev) => {
                // Allow other touch handlers but ensure tooltip shows
                showTooltipFor(element, hintText);
            }, {passive: true});
        }

        // Shared state for all counters
        let counterValues = [0,0,0,0,0,0,0,0];
        let resourcesValue = parseInt(resourcesInput.value, 10);
        let thresholdValueProduction = parseInt(InputProduction.value, 10);
        let total = 0;
        let production = 0;

        // Function to update the spent resource and total production count
        function updateTotal() {
            // Use shared state
            const [fighter, infantry, cruiser, destroyer, carrier, dreadnought, flagship, warsun] = counterValues;
            production = (fighter * 2) + (infantry * 2) + cruiser + destroyer + carrier + dreadnought + flagship + warsun;
            total = fighter + infantry + (cruiser * 2) + destroyer + (carrier * 3) + (dreadnought * 4) + (flagship * 8) + (warsun * 12);
            // Apply Sarween Tools adjustment (cannot go below 0)
            const sarweenActive = sarweenCheckbox && sarweenCheckbox.checked;
            const adjustedTotal = Math.max(0, total - (sarweenActive ? 1 : 0));
            totalSpanResources.textContent = adjustedTotal;
            totalSpanProduction.textContent = production;
            updateProgressBar();
            updateWarning();
        }

        // Loop through each counter
        for (let i = 1; i <= 8; i++) {
            const decrementButton = document.getElementById(`counter${i}`).querySelector(".decrement");
            const incrementButton = document.getElementById(`counter${i}`).querySelector(".increment");
            const countSpan = document.getElementById(`counter${i}`).querySelector(".count");

            // Decrement button click event
            decrementButton.addEventListener("click", () => {
                if (counterValues[i-1] > 0) {
                    counterValues[i-1]--;
                    countSpan.textContent = counterValues[i-1];
                    updateTotal();
                    updateProgressBar();
                }
            });

            // Increment button click event
            incrementButton.addEventListener("click", () => {
                counterValues[i-1]++;
                countSpan.textContent = counterValues[i-1];
                updateTotal();
                updateProgressBar();
            });

            // Count input change event (if ever used)
            countSpan.addEventListener("input", () => {
                counterValues[i-1] = parseInt(countSpan.textContent, 10);
                updateTotal();
                updateProgressBar();
            });
        }

        // Reset button click event
        resetButton.addEventListener("click", () => {
            for (let i = 1; i <= 8; i++) {
                counterValues[i-1] = 0;
                const countSpan = document.getElementById(`counter${i}`).querySelector(".count");
                countSpan.textContent = "0";
            }
            total = 0;
            production = 0;
            totalSpanResources.textContent = total;
            totalSpanProduction.textContent = production;
            updateProgressBar();
            updateWarning();
        });

        // Update progress bar width and color
        function updateProgressBar() {
            // Use adjusted total when Sarween Tools is enabled
            const sarweenActive = sarweenCheckbox && sarweenCheckbox.checked;
            const adjustedTotal = Math.max(0, total - (sarweenActive ? 1 : 0));
            const denom = (resourcesValue && resourcesValue > 0) ? resourcesValue : 1;
            const percentage = (adjustedTotal / denom) * 100;
            progressBar.style.width = percentage > 100 ? "100%" : `${percentage}%`;
            if (adjustedTotal > resourcesValue) {
                progressBar.classList.add("exceeded");
            } else {
                progressBar.classList.remove("exceeded");
            }
			updateProgressBarProduction();
        }

        function updateProgressBarProduction() {
            const percentage = (production / thresholdValueProduction) * 100;
            progressBarProduction.style.width = percentage > 100 ? "100%" : `${percentage}%`;
            if (production > thresholdValueProduction) {
                progressBarProduction.classList.add("exceeded");
            } else {
                progressBarProduction.classList.remove("exceeded");
            }
        }

        // Update warning message
        function updateWarning() {
            const sarweenActive = sarweenCheckbox && sarweenCheckbox.checked;
            const adjustedTotal = Math.max(0, total - (sarweenActive ? 1 : 0));
            if (adjustedTotal > resourcesValue) {
                warningDiv.textContent = "Available resources exeeded!";
            } else {
                warningDiv.textContent = "";
            }

            if (production > thresholdValueProduction) {
                warningProductionDiv.textContent = "Available production exeeded!";
            } else {
                warningProductionDiv.textContent = "";
            }
        }

        // Listen for resources value changes
        resourcesInput.addEventListener("input", () => {
            resourcesValue = parseInt(resourcesInput.value, 10);
            updateProgressBar();
            updateWarning();
        });

        // Attach aria-live/tooltips for Resources and Production inputs (works for hover, focus, and touch)
        attachA11yHint(resourcesInput, resourcesInput.getAttribute('title') || 'this is the yellow number on all your unexhausted planets combined');
        attachA11yHint(InputProduction, InputProduction.getAttribute('title') || 'this is the production value on your space dock.');

        // Attach hint to Sarween Tools checkbox/label
        const sarweenLabel = document.querySelector('label[for="sarween"]');
        if (sarweenCheckbox) {
            sarweenCheckbox.addEventListener('change', () => {
                updateTotal();
                updateProgressBar();
                updateWarning();
            });
        }
        attachA11yHint(sarweenLabel, sarweenLabel && sarweenLabel.getAttribute('title'));

        // Attach hints to fighters and infantry <p> elements for capacity explanation
        const fighterLabel = document.querySelector('#counter1 p');
        const infantryLabel = document.querySelector('#counter2 p');
        attachA11yHint(fighterLabel, fighterLabel.getAttribute('title') || "Fighter ships don't count towards fleet size, but you must have CAPACITY from space docks or other ships.");
        attachA11yHint(infantryLabel, infantryLabel.getAttribute('title') || "Infantry don't count towards fleet size, but you must have CAPACITY on ships to take them off planet.");

        // Hide tooltip when tapping anywhere else on touch devices
        document.addEventListener('touchstart', (ev) => {
            // If the tap target is the tooltip or inside it, do nothing
            if (ev.target && (ev.target === tooltip || tooltip.contains(ev.target))) return;
            // If tapping an element that has the tooltip, that element's handler will show it.
            // Otherwise, hide.
            hideTooltip();
        }, {passive: true});

        // Listen for production value changes
        InputProduction.addEventListener("input", () => {
            thresholdValueProduction = parseInt(InputProduction.value, 10);
            updateProgressBar();
            updateWarning();
        });

        // Initial update of total, progress bar, and warning
        updateTotal();
        updateProgressBar();
        updateWarning();
    </script>
</body>
</html>